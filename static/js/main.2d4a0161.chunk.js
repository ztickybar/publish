(this["webpackJsonpztickybar-publisher"]=this["webpackJsonpztickybar-publisher"]||[]).push([[0],{196:function(e){e.exports=JSON.parse('{"name":"ztickybar-publisher","version":"0.1.4","private":true,"dependencies":{"@microsoft/microsoft-graph-client":"^2.0.0","@uifabric/fluent-theme":"^7.1.4","animejs":"^3.1.0","axios":"^0.19.0","dexie":"^2.0.4","dexie-observable":"^1.0.0-beta.5","dexie-syncable":"^1.0.0-beta.4","exceljs":"^3.5.0","https":"^1.0.0","into-stream":"5.1.1","lodash":"^4.17.15","mammoth":"^1.4.9","moment":"^2.24.0","msal":"*1.2.0","office-ui-fabric-core":"^11.0.0","office-ui-fabric-react":"^7.61.1","quill-delta-to-html":"^0.11.0","react":"^16.12.0","react-dom":"^16.12.0","react-dropzone":"^10.2.1","react-grid-layout":"^0.17.1","react-resizable":"^1.10.1","react-scripts":"3.2.0","string-to-stream":"^3.0.1","xlsx":"^0.15.4","format-json":"^1.0.3"},"devDependencies":{"gh-pages":"^2.1.1"},"scripts":{"start":"PORT=3002 react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","config-default":"cp src/config/default/index.html public/index.html && cp src/config/default.js src/config/index.js","config-nets":"cp src/config/nets/index.html public/index.html && cp src/config/nets.js src/config/index.js","deploy":"cp src/config/default/index.html public/index.html && cp src/config/default.js src/config/index.js && react-scripts build && gh-pages -b master -d build -r https://github.com/ztickybar/publish","deploy-nets":"cp src/config/nets/index.html public/index.html && cp src/config/nets.js src/config/index.js && react-scripts build && echo publish.nets-intranets.com > build/CNAME && cp build/index.html build/404.html && gh-pages -b master -d build -r https://github.com/nets-intranets/publish"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},211:function(e,t,n){e.exports=n(429)},216:function(e,t,n){},234:function(e,t){},236:function(e,t){},268:function(e,t){},269:function(e,t){},334:function(e,t){},427:function(e,t,n){},428:function(e,t){},429:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),o=n(55),a=n.n(o),c=(n(216),n(45)),s=n.n(c),l=n(72),u=n(33),f=n(194),p=n(195),d=(n(218),{clientId:"443ae28d-8cf8-42fd-ba63-f403ac085ead",scopes:["user.readwrite","Sites.Read.All"],title:"ZTICKYBAR Publisher"}),m=n(206),h=n(205);var g={getAccessToken:function(e){var t=window.location.protocol+"//"+window.location.hostname+(80!==window.location.port&&443!==window.location.port&&""!==window.location.port?":"+window.location.port:"")+window.location.pathname;console.log("login replyUrl",t);var n={auth:{clientId:d.clientId,redirectUri:t,authority:"https://login.microsoftonline.com/common"}},r=new h.a(n);return new Promise(function(){var t=Object(l.a)(s.a.mark((function t(n,i){var o,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={scopes:e},r.handleRedirectCallback((function(e,t){})),r.getAccount()||r.loginRedirect(o),t.prev=3,t.next=6,r.acquireTokenSilent(o);case 6:a=t.sent,n(a.accessToken),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),i(t.t0);case 13:case"end":return t.stop()}}),t,null,[[3,10]])})));return function(e,n){return t.apply(this,arguments)}}())}},v=n(48),b=n.n(v),x=n(127),w=n.n(x),y=n(449),k=n(8),E=n(204),j=n(448),O=(n(427),n(196));Object(m.a)();var N=function(){function e(){var t=this;Object(f.a)(this,e),this.tools=function(){return new Promise((function(e,t){e([])}))},this.setNotificationCount=function(e,n){var r=window.self!==window.top?window.top:window.self;r&&r.postMessage({action:"setNotificationCount",count:n,tileId:e,key:t._key},t._targetOrigin)},this._key="123",this._targetOrigin="*"}return Object(p.a)(e,[{key:"openerHref",get:function(){return this._openerHref}},{key:"tileId",get:function(){return this._tileId}}]),e}();N.init=function(){return new N};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(428);a.a.render(i.a.createElement((function(){var e=["User.ReadWrite","Sites.Read.All"],t=Object(r.useState)(!0),n=Object(u.a)(t,2),o=n[0],a=(n[1],Object(r.useState)([])),c=Object(u.a)(a,2),f=c[0],p=c[1],m=Object(r.useState)({}),h=Object(u.a)(m,2),v=h[0],x=h[1],S=Object(r.useState)([]),C=Object(u.a)(S,2),I=C[0],A=C[1],z=Object(r.useState)({}),_=Object(u.a)(z,2),B=_[0],T=_[1],P=function(){try{return window.self!==window.top}catch(e){return!0}}(),R=Object(r.useState)(""),J=Object(u.a)(R,2),U=J[0],L=J[1],G=Object(r.useState)(0),W=Object(u.a)(G,2),D=W[0],M=W[1],q=Object(r.useState)(!1),H=Object(u.a)(q,2),K=H[0],Y=H[1],Z=Object(r.useState)(0),V=Object(u.a)(Z,2),$=V[0],F=V[1];function Q(){return(Q=Object(l.a)(s.a.mark((function t(){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g.getAccessToken(e);case 3:return n=t.sent,L(n),t.next=7,b.a.get(n,"https://graph.microsoft.com/v1.0/me");case 7:r=t.sent,x(r),t.next=22;break;case 11:t.prev=11,t.t0=t.catch(0),t.t1=t.t0.errorCode,t.next="user_login_error"===t.t1?16:18;break;case 16:case 18:return t.abrupt("break",20);case 20:f.push({context:" OfficeGraph.auth.getAccessToken()",error:t.t0}),p(f);case 22:case"end":return t.stop()}}),t,null,[[0,11]])})))).apply(this,arguments)}return Object(r.useEffect)((function(){N.init();var e=localStorage.getItem("ztickyBarNotificationCount");e&&parseInt(e);!function(){Q.apply(this,arguments)}(),U&&b.a.get(U,"https://graph.microsoft.com/v1.0/me/extensions/".concat(d.extensionName)).then((function(e){try{X(e.seenAlerts)}catch(t){f.push({context:"Post init",error:t}),p(f),X(null)}})).catch((function(e){f.push({context:"OfficeGraph.myExtentions() ",error:e}),p(f)}))}),[U,D]),i.a.createElement("div",{style:{position:"relative",height:"95vh"}},!P&&d.components&&d.components.header&&d.components.header,f.length>0&&i.a.createElement(y.a,{messageBarType:k.a.error,isMultiline:!1,onDismiss:function(){p(f.slice(1))},dismissButtonAriaLabel:"Close"},"Error: ",JSON.stringify(f[0])),i.a.createElement("div",{style:{backgroundColor:"#eeeeee"}},i.a.createElement("div",{style:{padding:"20px",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px",backgroundColor:"#ffffff",height:"80vh"}},!o&&i.a.createElement("div",{style:{textAlign:"center",marginTop:"30vh"}},i.a.createElement(E.a,{text:"Sign in",onClick:function(){alert("Not implemented")}})),I.map((function(e,t){return i.a.createElement("div",{className:"alert"},i.a.createElement("div",{style:{fontWeight:e.read?300:600,display:"flex",cursor:K?"wait":"pointer"},onClick:function(){K||e.read||(Y(!0),B.push({id:e.id,url:e.url,date:w.a.utc()}),ee(B).then((function(){Y(!1)})).catch((function(){Y(!1)})))}},i.a.createElement("div",{style:{position:"relative",flexGrow:1}},i.a.createElement("div",{style:{fontSize:"24px",padding:"10px"}},e.title),i.a.createElement("div",{style:{fontSize:"12px",padding:"10px"}},e.message),i.a.createElement("div",{style:{fontSize:"12px",padding:"10px"}},"Last updated: ",w()(e.date).format("LLLL"))),i.a.createElement("div",null,e.url&&i.a.createElement("a",{href:e.url,target:"_blank"},"Details"))))})))),!P&&i.a.createElement("div",{style:{position:"absolute",bottom:0}},i.a.createElement("div",{style:{display:"flex",width:"100vw"}},i.a.createElement("div",{style:{flexGrow:1,padding:8}},v&&i.a.createElement("div",null,v.displayName," (",v.userPrincipalName,")"),d.alertsUrl&&i.a.createElement("a",{href:d.alertsUrl,target:"_blank"},d.alertsUrl),i.a.createElement("div",null,i.a.createElement("button",{onClick:function(){var e=localStorage.getItem("ztickyBarNotificationCount"),t=e?parseInt(e)>0?parseInt(e)+1:1:0;localStorage.setItem("ztickyBarNotificationCount",t),N.init().setNotificationCount(3,t)}},"+"),i.a.createElement("button",{onClick:function(){var e=localStorage.getItem("ztickyBarNotificationCount"),t=e?parseInt(e)>0?parseInt(e)-1:1:0;localStorage.setItem("ztickyBarNotificationCount",t),N.init().setNotificationCount(3,t)}},"-"))),i.a.createElement("div",{style:{flexGrow:1}},i.a.createElement("div",null,"Unread: ",$),i.a.createElement("div",null,i.a.createElement(j.a,{text:"clear",onClick:function(){ee([])}})),JSON.stringify(B)),i.a.createElement("div",{style:{padding:8,textAlign:"right"}},i.a.createElement("div",null,i.a.createElement("a",{href:"https://www.jumpto365.com",target:"_blank"},"ZTICKYBAR Notifier")),i.a.createElement("div",null,"Version ",O.version)))));function X(e){b.a.get(U,d.currentAlerts).then((function(t){var n={};if(t){var r=t.map((function(e){try{var t={id:e.fields.id,title:e.fields.Title,active:e.fields.Active,date:e.fields.Date,message:e.fields.Message,image:e.fields.RollupImage?e.fields.RollupImage.Url:null,url:e.fields.Url?e.fields.Url.Url:null};return n[e.fields.id]=t,t}catch(r){f.push({context:"OfficeGraph.getAlerts() map ",error:r}),p(f)}})),i=[];e&&e.forEach((function(e){n[e.id]&&(n[e.id].read=!0,i.push({id:e.id,url:n[e.id].url}))}));var o=r.length-e.length,a=N.init();F(o),window.document.title=o>0?d.title+" ("+o+" unread)":d.title,a.setNotificationCount(3,o),A(r),T(e)}})).catch((function(e){f.push({context:"OfficeGraph.getAlerts() ",error:e}),p(f)}))}function ee(e){return new Promise(function(){var t=Object(l.a)(s.a.mark((function t(n,r){var i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.get(U,"https://graph.microsoft.com/v1.0/me/extensions/".concat(d.extensionName));case 2:i=t.sent,(i?b.a.patch(U,"https://graph.microsoft.com/v1.0/me/extensions/".concat(d.extensionName),{"@odata.type":"#microsoft.graph.openTypeExtension",extensionName:d.extensionName,seenAlerts:e,etag:i.etag+1,id:d.extensionName}):b.a.post(U,"https://graph.microsoft.com/v1.0/me/extensions",{"@odata.type":"#microsoft.graph.openTypeExtension",extensionName:d.extensionName,seenAlerts:e,etag:1,id:d.extensionName})).then((function(e){try{M(D+1),n()}catch(t){f.push({context:"Post init",error:t}),p(f),X(null),n()}})).catch((function(e){f.push({context:"setSeenAlerts ",error:e}),p(f),n()}));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},48:function(e,t,n){var r=n(219),i={},o={tokenEndpoint:"https://login.microsoftonline.com/common/oauth2/token"};i.getAccessToken=function(){if(window)throw"Not valid client side";return new Promise((function(e,t){var n={grant_type:"client_credentials",client_id:o.clientId,client_secret:o.clientSecret,resource:"https://graph.microsoft.com"};r.post({url:o.tokenEndpoint,form:n},(function(n,r,i){var o=JSON.parse(i);n?t(n):o.error?t(o.error_description):e(o.access_token)}))}))},e.exports.getRaw=function(e,t){return console.log("getting",t),new Promise((function(n,i){r.get({url:t,headers:{authorization:"Bearer "+e}},(function(e,t,r){if(e)return n({hasError:!0,error:e});n({hasError:!1,result:r})}))}))},e.exports.get=function(e,t){return new Promise((function(n,i){!function e(t,n,i,o,a,c){console.log("getting",n,!0===o),r.get({url:n,headers:{"content-type":"application/json",authorization:"Bearer "+t}},(function(r,s,l){var u,f;if(r){var p=c?c+1:1;return p>3?i(r,null,a):(console.log("retry #",p),e(t,n,i,o,a,p))}return(u=JSON.parse(l)).error?i(u.error,null,a):u["@odata.nextLink"]?(f=o?o.concat(u.value):u.value,e(t,u["@odata.nextLink"],i,f,a)):void(o?i(null,o.concat(u.value),a):u.value?i(null,u.value,a):i(null,u,a))}))}(e,t,(function(e,t){if(e)return i(e);n(t)}))}))},e.exports.post=function(e,t,n){return new Promise((function(i,o){!function(e,t,n,i){r.post({url:t,headers:{"content-type":"application/json",authorization:"Bearer "+e},body:JSON.stringify(n)},(function(e,t,n){var r;return e?i(e):(r=""===n?{}:JSON.parse(n)).error?i(r.error):void i(null,r)}))}(e,t,n,(function(e,t){if(e)return o(e);i(t)}))}))},e.exports.patch=function(e,t,n){return new Promise((function(i,o){!function(e,t,n,i){r.patch({url:t,headers:{"content-type":"application/json",authorization:"Bearer "+e},body:JSON.stringify(n)},(function(e,t,n){var r;return e?i(e):(r=""===n?{}:JSON.parse(n)).error?i(r.error):void i(null,r)}))}(e,t,n,(function(e,t){if(e)return o(e);i(t)}))}))},e.exports.auth=i}},[[211,1,2]]]);
//# sourceMappingURL=main.2d4a0161.chunk.js.map